{{ define "main" }}
<div class="pa3 pa4-ns">
    <div class="measure-wide center">
        <!-- Page title and content -->
        <header class="mb4">
            <h1 class="f2 lh-title fw9 mb3 mt0 pt3 black">{{ .Title }}</h1>
            <div class="f4 lh-copy measure">{{ .Content }}</div>
        </header>

        <!-- Contact information -->
        {{ $dojoData := index .Site.Data .Site.Language.Lang "dojo" }}
        {{ if $dojoData }}
        <div class="contact-container">
            <div class="flex-l">
                <!-- Contact Details -->
                <div class="w-100 w-50-l pr4-l mb4 mb0-l">
                    <div class="contact-info">
                        <!-- Dojo Name -->
                        {{ if $dojoData.dojo_name }}
                        <div class="contact-item mb4">
                            <h2 class="f3 fw6 mb2 black">{{ $dojoData.dojo_name }}</h2>
                        </div>
                        {{ end }}

                        <!-- Address -->
                        {{ if $dojoData.address }}
                        <div class="contact-item mb4">
                            <h3 class="f4 fw6 mb2 black">
                                {{ i18n "address" }}
                            </h3>
                            <div class="f5 lh-copy gray">
                                {{ $dojoData.address | replaceRE "\n" "<br>" | safeHTML }}
                            </div>
                        </div>
                        {{ end }}

                        <!-- Phone -->
                        {{ if $dojoData.phone }}
                        <div class="contact-item mb4">
                            <h3 class="f4 fw6 mb2 black">
                                {{ i18n "phone_contact" }}
                            </h3>
                            <div class="f5 lh-copy">
                                <a href="tel:{{ $dojoData.phone | replaceRE " [^0-9+]" "" }}"
                                    class="link red hover-dark-red">
                                    {{ $dojoData.phone }}
                                </a>
                            </div>
                        </div>
                        {{ end }}

                        <!-- Email -->
                        {{ if $dojoData.email }}
                        <div class="contact-item mb4">
                            <h3 class="f4 fw6 mb2 black">
                                {{ i18n "email_contact" }}
                            </h3>
                            <div class="f5 lh-copy">
                                <a href="mailto:{{ $dojoData.email }}" class="link red hover-dark-red">
                                    {{ $dojoData.email }}
                                </a>
                            </div>
                        </div>
                        {{ end }}
                    </div>
                </div>

                <!-- Map Section -->
                <div class="w-100 w-50-l">
                    <div class="map-container">
                        <h3 class="f4 fw6 mb3 black">
                            {{ i18n "location" }}
                        </h3>

                        {{ if $dojoData.map_embed_url }}
                        <!-- Embedded Map -->
                        <div class="map-frame ba b--light-gray br2 overflow-hidden" style="height: 300px;">
                            <iframe src="{{ $dojoData.map_embed_url }}" width="100%" height="100%" style="border: 0;"
                                allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"
                                title="{{ $dojoData.dojo_name }} - {{ i18n "location" }}">
                            </iframe>
                        </div>

                        <!-- Map fallback text for accessibility -->
                        <div class="map-fallback mt2">
                            <p class="f6 gray lh-copy">
                                <a href="{{ $dojoData.map_embed_url | replaceRE "/export/embed.html" "" }}"
                                    target="_blank" rel="noopener noreferrer" class="link red hover-dark-red">
                                    {{ i18n "view_full_map" }}
                                </a>
                            </p>
                        </div>
                        {{ else }}
                        <!-- Map Placeholder (when no URL is available) -->
                        <div class="map-placeholder ba b--light-gray br2 pa4 tc bg-light-gray"
                            style="min-height: 300px;">
                            <div class="flex items-center justify-center h-100">
                                <div class="tc">
                                    <div class="f1 mb3">üó∫Ô∏è</div>
                                    <p class="f5 gray ma0 mb2">
                                        {{ i18n "map_not_available" }}
                                    </p>
                                    {{ if $dojoData.address }}
                                    <div class="f6 gray lh-copy mt2">
                                        {{ i18n "refer_address" }}
                                    </div>
                                    {{ end }}
                                </div>
                            </div>
                        </div>
                        {{ end }}
                    </div>
                </div>
            </div>
        </div>
        {{ else }}
        <!-- Fallback when no dojo data exists -->
        <div class="no-contact-data pa4 ba b--light-gray br2 bg-light-gray tc">
            <h3 class="f4 fw6 gray">
                {{ i18n "contact_info_soon" }}
            </h3>
            <p class="f5 gray lh-copy">
                {{ i18n "organizing_info" }}
            </p>
        </div>
        {{ end }}
    </div>
</div>

<style>
    .contact-info .contact-item {
        border-left: 3px solid #357edd;
        padding-left: 1rem;
    }

    .contact-info .contact-item h3 {
        margin-bottom: 0.5rem;
    }

    .map-frame {
        position: relative;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .map-frame iframe {
        display: block;
        width: 100%;
        height: 100%;
    }

    .map-placeholder {
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .map-fallback a {
        text-decoration: none;
        font-weight: 500;
    }

    .map-fallback a:hover {
        text-decoration: underline;
    }

    @media screen and (max-width: 60em) {
        .contact-container .flex-l {
            flex-direction: column;
        }

        .contact-container .w-50-l {
            width: 100%;
        }

        .contact-container .pr4-l {
            padding-right: 0;
        }

        .map-frame {
            height: 250px !important;
        }
    }

    @media screen and (max-width: 30em) {
        .map-frame {
            height: 200px !important;
        }
    }
</style>
{{ end }}